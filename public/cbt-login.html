<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CBT Login | Gold and Linc Schools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts & Font Awesome -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    :root {
      --primary: #1847a6;
      --accent: #17c3b2;
      --error: #e74c3c;
      --radius: 18px;
      --shadow: 0 4px 24px rgba(24, 71, 166, 0.10);
      --bg: linear-gradient(120deg, #e6eefe 0%, #b2c6e6 100%);
      --glass-bg: rgba(255,255,255,0.92);
      --glass-border: rgba(24,71,166,0.07);
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: var(--bg);
      color: #1a2b4b;
      min-height: 100vh;
    }
    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cbt-login-main {
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      display: flex;
      background: var(--glass-bg);
      border: 1.5px solid var(--glass-border);
      overflow: hidden;
      max-width: 840px;
      width: 100%;
      margin: 0 auto;
    }
    .cbt-login-side {
      background: linear-gradient(135deg, #1847a6 75%, #17c3b2 100%);
      color: #fff;
      flex: 1.2;
      min-width: 260px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 40px 24px 30px 24px;
    }
    .cbt-login-side .logo {
      width: 84px;
      height: 84px;
      border-radius: 15px;
      background: #fff;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 2px 16px rgba(0,0,0,.08);
    }
    .cbt-login-side h1 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 800;
      font-size: 1.35rem;
      margin-bottom: 16px;
      letter-spacing: 1.2px;
      text-shadow: 0 2px 8px rgba(10,50,150,0.10);
      text-align: center;
    }
    .cbt-login-side .subtitle {
      font-size: 1.08rem;
      font-weight: 500;
      opacity: 0.93;
      margin-bottom: 18px;
      text-align: center;
    }
    .cbt-login-side .fa-laptop-code {
      font-size: 2.1rem;
      opacity: 0.82;
      margin-bottom: 20px;
      margin-top: 6px;
      color: #fff;
    }
    .cbt-login-side .info-row {
      font-size: 1.05rem;
      opacity: 0.97;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 9px;
      justify-content: center;
    }
    .cbt-login-side .socials {
      margin-top: 20px;
      display: flex;
      gap: 13px;
      justify-content: center;
    }
    .cbt-login-side .socials a {
      color: #fff;
      font-size: 1.22rem;
      opacity: 0.85;
      border-radius: 100px;
      padding: 2px 5px;
      transition: color .14s, opacity .15s;
    }
    .cbt-login-side .socials a:hover {
      opacity: 1;
      color: var(--accent);
      background: rgba(255,255,255,0.15);
    }
    .cbt-login-form-section {
      flex: 1.5;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
    }
    .cbt-login-card {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1.5px solid var(--glass-border);
      padding: 36px 32px 28px 32px;
      max-width: 370px;
      width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }
    .cbt-login-card .icon {
      font-size: 2.3rem;
      color: var(--primary);
      margin-bottom: 8px;
      text-align: center;
      width: 100%;
      opacity: 0.95;
    }
    .cbt-login-card h2 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 800;
      font-size: 1.23rem;
      letter-spacing: 0.5px;
      margin-bottom: 19px;
      color: #1a2b4b;
      text-align: center;
    }
    .cbt-login-card label {
      font-size: 1.06rem;
      font-weight: 600;
      color: #1847a6;
      margin-bottom: 2px;
      margin-top: 10px;
      display: block;
    }
    .cbt-login-card input[type="text"], .cbt-login-card input[type="password"] {
      width: 100%;
      font-size: 1.09rem;
      border-radius: 9px;
      border: 1.2px solid #dbe2ee;
      padding: 12px 12px;
      background: #f7f9fc;
      margin-bottom: 14px;
      margin-top: 2px;
      box-sizing: border-box;
      transition: border .15s;
    }
    .cbt-login-card input:focus {
      outline: none;
      border-color: #1847a6;
      background: #f1f5fd;
    }
    .cbt-login-card .input-group {
      position: relative;
      width: 100%;
    }
    .cbt-login-card .toggle-pw {
      position: absolute;
      right: 11px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #a3b7ce;
      font-size: 1.13rem;
      cursor: pointer;
      padding: 2px 6px;
      z-index: 2;
      outline: none;
    }
    .cbt-login-card .form-check {
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 1.01rem;
      width: 100%;
    }
    .cbt-login-card .form-check-input[type="checkbox"] {
      width: 17px;
      height: 17px;
      border-radius: 4px;
    }
    .cbt-login-card .btn-primary {
      padding: 12px 0;
      background: #1847a6;
      border-radius: 9px;
      border: none;
      font-size: 1.11rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      color: #fff;
      margin-bottom: 13px;
      margin-top: 6px;
      width: 100%;
      box-shadow: 0 2px 8px rgba(24,71,166,0.11);
      transition: background .18s, box-shadow .18s;
      cursor: pointer;
    }
    .cbt-login-card .btn-primary:active, .cbt-login-card .btn-primary:focus { background: #174e8b; }
    .cbt-login-card .row-links {
      display: flex;
      justify-content: space-between;
      margin-bottom: 13px;
      font-size: 1.01rem;
      gap: 12px;
      width: 100%;
    }
    .cbt-login-card .row-links a {
      color: #1847a6;
      text-decoration: none;
      font-weight: 500;
      opacity: 0.93;
      transition: opacity .15s;
    }
    .cbt-login-card .row-links a:hover { opacity: 1; text-decoration: underline; }
    .cbt-login-card #cbt-spinner {
      display: none;
      text-align: center;
      margin-top: 10px;
      width: 100%;
    }
    .cbt-login-card .error-msg {
      background: #fff4f4;
      color: var(--error);
      border: 1.2px solid #f9caca;
      border-radius: 5px;
      padding: 7px 11px;
      margin-bottom: 10px;
      font-size: 0.97rem;
      display: none;
    }
    @media (max-width: 900px) {
      .cbt-login-main {
        flex-direction: column;
        max-width: 97vw;
        margin: 0 7px;
      }
      .cbt-login-side {
        min-width: 0;
        padding: 35px 7vw 20px 7vw;
        border-radius: 0 0 var(--radius) var(--radius);
      }
      .cbt-login-form-section {
        padding: 0 7vw 20px 7vw;
      }
      .cbt-login-card {
        padding: 28px 7vw 20px 7vw;
        max-width: 100vw;
        border-radius: var(--radius);
      }
    }
    @media (max-width: 600px) {
      .cbt-login-side {
        padding: 24px 2vw 15px 2vw;
      }
      .cbt-login-card {
        padding: 18px 3vw 15px 3vw;
        border-radius: 16px;
      }
    }
    @media (max-width: 440px) {
      .cbt-login-side { padding: 10px 1vw 8px 1vw; }
      .cbt-login-card { padding: 7px 1vw 8px 1vw; }
      .cbt-login-card h2 { font-size: 0.95rem; }
    }
  </style>
</head>
<body>
  <div class="cbt-login-main">
    <!-- Side Panel -->
    <div class="cbt-login-side">
      <div class="logo">
        <img src="logo-1679575828 (1).jpeg" alt="School Logo" style="width:100%;height:100%;">
      </div>
      <h1>GOLD AND LINC SCHOOLS</h1>
      <div class="subtitle">CBT Student Login</div>
      <div><i class="fa fa-laptop-code"></i></div>
      <div class="info-row">
        <i class="fa fa-envelope"></i>
        goldlincschool@gmail.com
      </div>
      <div class="info-row">
        <i class="fa fa-phone"></i>
        08034430941
      </div>
      <div class="socials">
        <a href="https://facebook.com" target="_blank" title="Facebook"><i class="fab fa-facebook-square"></i></a>
        <a href="https://twitter.com" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
        <a href="https://instagram.com" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
    <!-- Login Form Card -->
    <div class="cbt-login-form-section">
      <div class="cbt-login-card">
        <div class="icon">
          <i class="fa fa-user-graduate"></i>
        </div>
        <h2>CBT Portal Login</h2>
        <form id="cbtLoginForm" autocomplete="on">
          <div class="error-msg" id="cbtErrorMsg"></div>
          <label for="student-id">E-Mail or Reg. No.</label>
          <input type="text" id="student-id" name="student-id" autocomplete="username" placeholder="Enter your email or registration number" required>
          <div class="input-group mb-2">
            <label for="student-password">Password / Access Code</label>
            <input type="password" id="student-password" name="student-password" autocomplete="current-password" placeholder="Enter your password" required>
            <button type="button" class="toggle-pw" tabindex="-1" onclick="togglePw()"><i class="fa fa-eye"></i></button>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="keepLoggedIn">
            <label class="form-check-label" for="keepLoggedIn">
              Keep me logged on
            </label>
          </div>
          <button type="submit" class="btn-primary">LOGIN TO CBT</button>
          <div id="cbt-spinner">
            <i class="fa fa-spinner fa-spin" style="font-size: 1.4rem; color: #1847a6;"></i>
          </div>
          <div class="row-links">
            <a href="#">Forgot Password?</a>
            <a href="#">Need Help?</a>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script>
    // Password toggle
    function togglePw() {
      const pwInput = document.getElementById('student-password');
      const pwToggle = document.querySelector('.toggle-pw i');
      if (pwInput.type === "password") {
        pwInput.type = "text";
        pwToggle.classList.remove('fa-eye');
        pwToggle.classList.add('fa-eye-slash');
      } else {
        pwInput.type = "password";
        pwToggle.classList.remove('fa-eye-slash');
        pwToggle.classList.add('fa-eye');
      }
    }

    // Login logic
    document.addEventListener('DOMContentLoaded', function() {
      const loginForm = document.getElementById('cbtLoginForm');
      const errorMsg = document.getElementById('cbtErrorMsg');
      const spinner = document.getElementById('cbt-spinner');
      const submitBtn = loginForm.querySelector('button[type="submit"]');

      loginForm.addEventListener('submit', async function (e) {
        e.preventDefault();

        errorMsg.style.display = 'none';
        spinner.style.display = 'none';
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';

        const loginVal = document.getElementById('student-id').value.trim();
        const password = document.getElementById('student-password').value.trim();

        if (!loginVal || !password) {
          errorMsg.innerText = 'Please fill in all fields.';
          errorMsg.style.display = 'block';
          return;
        }

        const isEmail = loginVal.includes('@');
        const body = isEmail
          ? { email: loginVal, password }
          : { regNo: loginVal, password };

        spinner.style.display = 'block';
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.6';

        try {
          const res = await fetch('https://goldlincschools.onrender.com/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body),
          });

          let data = {};
          try {
            data = await res.json();
          } catch (err) {
            errorMsg.innerText = 'Server error: Invalid response.';
            errorMsg.style.display = 'block';
            return;
          }

          if (res.ok && data?.token) {
            // Store token for CBT page
            localStorage.setItem('student_token', data.token);
            // Redirect student to CBT page
            window.location.href = 'cbt.html';
          } else {
            errorMsg.innerText = data?.error || 'Invalid login credentials';
            errorMsg.style.display = 'block';
          }
        } catch (err) {
          errorMsg.innerText = 'Network or server error';
          errorMsg.style.display = 'block';
        } finally {
          spinner.style.display = 'none';
          submitBtn.disabled = false;
          submitBtn.style.opacity = '1';
        }
      });
    });
  </script>
</body>
</html>
