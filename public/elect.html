<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voting Platform Admin Panel - With Activity Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
  <style>
    /* [All the CSS from previous advanced UI and activity log, merged] */
    :root {
      --primary: #1e90ff;
      --primary-dark: #1877cc;
      --accent: #ffb300;
      --bg: #f7faff;
      --sidebar-bg: #212a3a;
      --sidebar-active: #25304b;
      --text: #252e3e;
      --text-light: #7d8ca9;
      --card-bg: #fff;
      --shadow: 0 4px 24px 0 rgba(30, 144, 255, 0.08);
      --radius: 16px;
      --danger: #ff4545;
      --success: #24b47e;
      --warning: #ffd600;
      --table-border: #ececec;
      --transition: all .18s cubic-bezier(.4,0,.2,1);
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; font-family: 'Inter', Arial, sans-serif; background: var(--bg); color: var(--text);
      font-size: 16px;
    }
    body { display: flex; min-height: 100vh; }
    .sidebar {
      width: 260px; background: var(--sidebar-bg); color: #fff; flex-shrink: 0; display: flex; flex-direction: column;
      box-shadow: 2px 0 24px 0 rgba(30,144,255,0.07); z-index: 10;
    }
    .sidebar-header {
      padding: 40px 0 32px 0; text-align: center; font-size: 2em; font-weight: 700; letter-spacing: 1px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: #fff; border-bottom: 1px solid #22304b;
      box-shadow: 0 2px 8px 0 rgba(30,144,255,0.04);
    }
    .sidebar ul {
      list-style: none; padding: 0; margin: 0; flex: 1;
    }
    .sidebar ul li {
      margin: 0;
    }
    .sidebar ul li a {
      color: #fff; text-decoration: none; display: block;
      padding: 16px 36px; font-size: 1.08em; font-weight: 500;
      transition: var(--transition);
      border-left: 4px solid transparent;
      position: relative;
    }
    .sidebar ul li a.active,
    .sidebar ul li a:hover {
      background: var(--sidebar-active);
      border-left: 4px solid var(--primary);
    }
    .sidebar-footer {
      padding: 24px 0; text-align: center; font-size: 0.88em; color: #7d8ca9;
      border-top: 1px solid #1a2333;
    }
    main {
      flex: 1; padding: 0 0 0 0; margin-left: 0; min-height: 100vh;
      display: flex; flex-direction: column;
    }
    .topbar {
      width: 100%; background: #fff; box-shadow: 0 2px 12px 0 rgba(30,144,255,0.06);
      padding: 18px 36px; display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 5;
    }
    .topbar h1 { margin: 0; font-size: 1.7em; font-weight: 700; color: var(--primary-dark);}
    .topbar .profile {
      display: flex; align-items: center; gap: 14px;
    }
    .topbar .profile img {
      width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--primary);
      object-fit: cover;
    }
    .topbar .profile span {
      font-weight: 600; color: var(--text);
    }
    .container {
      flex: 1; padding: 34px 40px 40px 40px; background: var(--bg);
      min-height: 0; overflow-y: auto;
    }
    section { display: none; }
    section.active { display: block; animation: fadeIn .5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(16px);} to { opacity: 1; transform: none;} }
    .dashboard-cards {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(210px,1fr)); gap: 34px; margin-bottom: 40px;
    }
    .card {
      background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 32px 24px; display: flex; flex-direction: column; align-items: flex-start;
      position: relative; min-height: 100px;
    }
    .card h3 { margin: 0 0 14px 0; font-size: 1.16em; color: var(--primary-dark); font-weight: 600;}
    .card .card-value { font-size: 2.5em; font-weight: 700; color: var(--text);}
    .card .trend { margin-top: 6px; font-size: 0.95em; }
    .card .trend.up { color: var(--success);}
    .card .trend.down { color: var(--danger);}
    .card .card-icon { position: absolute; top: 22px; right: 24px; font-size: 2.1em; opacity: 0.16;}
    .recent {
      background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 25px 36px; margin-bottom: 24px;
    }
    .recent h2 { margin: 0 0 18px 0; font-size: 1.18em; color: var(--primary-dark); }
    .recent ul { padding: 0; margin: 0; list-style: none; }
    .recent ul li {
      padding: 10px 0; border-bottom: 1px dashed #e4e7ef; font-size: 1.03em; color: var(--text-light);
      display: flex; align-items: center; gap: 10px;
    }
    .recent ul li:last-child { border-bottom: none; }
    .recent ul li .dot {
      width: 8px; height: 8px; border-radius: 50%; background: var(--primary); flex-shrink: 0;
      display: inline-block;
    }
    .table-responsive { width: 100%; overflow-x: auto; }
    table {
      width: 100%; border-collapse: collapse; background: var(--card-bg);
      border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 20px;
      font-size: 1em; min-width: 690px;
    }
    th, td { padding: 12px 8px; border-bottom: 1px solid var(--table-border);}
    th { background: #f4f6fb; color: var(--primary-dark); font-weight: 600;}
    tr:last-child td { border-bottom: none;}
    tr.duplicate { background: #fff4f4;}
    tr.success { background: #f7fff9;}
    tr:hover { background: #f6faff;}
    .action-btns { display: flex; gap: 8px;}
    .btn {
      background: var(--primary); color: #fff; border: none; border-radius: 7px;
      padding: 7px 18px; font-size: 1em; font-weight: 600; cursor: pointer;
      transition: var(--transition);
    }
    .btn:active, .btn:hover { background: var(--primary-dark);}
    .btn.danger { background: var(--danger);}
    .btn.danger:active, .btn.danger:hover { background: #e32b2b;}
    .btn.small { padding: 6px 12px; font-size: 0.95em;}
    .btn.secondary { background: #ececec; color: var(--text);}
    .btn.secondary:hover { background: #d1e9ff;}
    .search-bar {
      display: flex; align-items: center; gap: 14px; margin-bottom: 18px;
    }
    .search-bar input[type="text"], .search-bar input[type="date"] {
      padding: 8px 12px; border: 1px solid #c4d1e3; border-radius: 5px;
      background: #f7faff; font-size: 1em; color: var(--text);
      transition: border-color .16s;
    }
    .search-bar input:focus { outline: none; border-color: var(--primary);}
    .settings-box {
      background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 26px 40px; margin-bottom: 24px;
    }
    .settings-box h3 { margin-top: 0; font-size: 1.15em; color: var(--primary-dark); }
    .settings-box label { display: block; margin: 16px 0 6px 0; font-weight: 500;}
    .settings-box input[type="text"] { width: 100%; }
    .settings-box button { margin-top: 18px; }
    .modal {
      display: none; position: fixed; z-index: 99; left: 0; top: 0; width: 100%; height: 100%;
      overflow: auto; background-color: rgba(21, 30, 45, 0.24);
      align-items: center; justify-content: center;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: #fff; padding: 32px; border-radius: 12px; box-shadow: 0 8px 36px rgba(30,144,255,0.18);
      min-width: 330px; width: 100%; max-width: 410px;
    }
    .modal-content h2 { margin-top: 0; color: var(--primary-dark);}
    .modal-content label { display: block; margin-top: 18px;}
    .modal-content input, .modal-content select {
      width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #c4d1e3; border-radius: 5px;
      background: #f7faff; font-size: 1em;
    }
    .modal-content .modal-actions {
      margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;
    }
    .modal-content .error {
      color: var(--danger); margin-top: 7px; font-size: 0.98em; display: none;
    }
    @media (max-width:1100px){ .container{padding:18px 5vw;} .dashboard-cards{gap:14px;} .recent{padding:16px 10px;} }
    @media (max-width:780px){ .sidebar{width:62px;} .sidebar-header{font-size:1.08em;padding:22px 0;} .sidebar ul li a{padding:10px 12px;font-size:1em;} .sidebar ul li a span{display:none;} .container{padding:14px 2vw;} .topbar{padding:10px 12px;} table{font-size:0.97em;} }
    @media (max-width:600px){ .dashboard-cards{grid-template-columns:1fr;} .container{padding:4px 0.5vw;} th,td{padding:10px 6px;} }
  </style>
</head>
<body>
  <!-- Sidebar and Topbar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <span>üó≥Ô∏è VotePlus</span>
    </div>
    <ul>
      <li><a href="#" data-section="dashboard" class="active"><span>üè†</span> Dashboard</a></li>
      <li><a href="#" data-section="elections"><span>üìù</span> Elections</a></li>
      <li><a href="#" data-section="candidates"><span>üë§</span> Candidates</a></li>
      <li><a href="#" data-section="voters"><span>üßë‚Äçü§ù‚Äçüßë</span> Voters</a></li>
      <li><a href="#" data-section="results"><span>üìä</span> Results</a></li>
      <li><a href="#" data-section="voter-logs"><span>üïí</span> Voter Logs</a></li>
      <li><a href="#" data-section="activity-log"><span>üìú</span> Activity Log</a></li>
      <li><a href="#" data-section="settings"><span>‚öôÔ∏è</span> Settings</a></li>
    </ul>
    <div class="sidebar-footer">
      &copy; 2025 VotePlus <br> All rights reserved.
    </div>
  </nav>
  <main>
    <div class="topbar">
      <h1 id="section-title">Dashboard</h1>
      <div class="profile">
        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Admin">
        <span>Richarddtimm230</span>
      </div>
    </div>
    <div class="container">
      <!-- DASHBOARD -->
      <section id="dashboard" class="active">
        <div class="dashboard-cards">
          <div class="card">
            <div class="card-icon">üó≥Ô∏è</div>
            <h3>Active Elections</h3>
            <span class="card-value" id="active-elections">0</span>
            <span class="trend up">+2 today</span>
          </div>
          <div class="card">
            <div class="card-icon">üßë‚Äçü§ù‚Äçüßë</div>
            <h3>Total Voters</h3>
            <span class="card-value" id="total-voters">0</span>
            <span class="trend up">+15 this week</span>
          </div>
          <div class="card">
            <div class="card-icon">üì•</div>
            <h3>Votes Cast</h3>
            <span class="card-value" id="votes-cast">0</span>
            <span class="trend up">+120 today</span>
          </div>
          <div class="card">
            <div class="card-icon">üìä</div>
            <h3>Turnout Rate</h3>
            <span class="card-value" id="turnout-rate">0%</span>
            <span class="trend up">up 4%</span>
          </div>
        </div>
        <div class="recent">
          <h2>Recent Activity</h2>
          <ul id="recent-activity"></ul>
        </div>
      </section>
      <!-- ELECTIONS -->
      <section id="elections">
        <div class="search-bar">
          <input type="text" id="election-search" placeholder="Search elections...">
          <button class="btn" id="add-election-btn">+ New Election</button>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Election</th>
                <th>Status</th>
                <th>Start</th>
                <th>End</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="elections-table"></tbody>
          </table>
        </div>
      </section>
      <!-- CANDIDATES -->
      <section id="candidates">
        <div class="search-bar">
          <input type="text" id="candidate-search" placeholder="Search candidates...">
          <button class="btn" id="add-candidate-btn">+ Add Candidate</button>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Election</th>
                <th>Profile</th>
                <th>Votes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="candidates-table"></tbody>
          </table>
        </div>
      </section>
      <!-- VOTERS -->
<section id="voters">
        <div class="search-bar">
          <input type="text" id="voter-search" placeholder="Search voters...">
          <button class="btn" id="add-voter-btn">+ Add Voter</button>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Voter ID</th>
                <th>Name</th>
                <th>Status</th>
                <th>Voted</th>
                <th>Voted Via</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="voters-table"></tbody>
          </table>
        </div>
      </section>
      <div class="modal" id="mark-voted-confirm-modal">
    <div class="modal-content">
      <h2>Confirm Mark as Voted</h2>
      <p>Are you sure you want to mark <span id="confirm-voter-name"></span> as having voted via paper ballot? This action cannot be undone, and the voter will not be able to vote online.</p>
      <div class="modal-actions">
        <button class="btn secondary" id="mark-voted-cancel">Cancel</button>
        <button class="btn danger" id="mark-voted-confirm">Yes, Mark as Voted</button>
      </div>
    </div>
  </div>
      <!-- RESULTS -->
      <section id="results">
        <div class="search-bar">
          <input type="text" id="results-search" placeholder="Search results...">
          <button class="btn secondary" onclick="alert('Export results feature coming soon.')">Export Results</button>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Election</th>
                <th>Candidate</th>
                <th>Votes</th>
              </tr>
            </thead>
            <tbody id="results-table"></tbody>
          </table>
        </div>
      </section>
      <!-- VOTER LOGS -->
      <section id="voter-logs">
        <div class="search-bar">
          <input type="text" id="log-search" placeholder="Search logs...">
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Voter ID</th>
                <th>Name</th>
                <th>Election</th>
                <th>Action</th>
                <th>Timestamp</th>
                <th>Status/Note</th>
              </tr>
            </thead>
            <tbody id="logs-table"></tbody>
          </table>
        </div>
      </section>
      <!-- ACTIVITY LOG -->
      <section id="activity-log">
        <div class="search-bar">
          <input type="text" id="admin-log-search" placeholder="Search by action, admin, target...">
          <input type="date" id="admin-log-date">
          <button class="btn secondary" id="export-log-btn">Export CSV</button>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Admin</th>
                <th>Action</th>
                <th>Target</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody id="activity-log-table"></tbody>
          </table>
        </div>
      </section>
      <!-- SETTINGS -->
      <section id="settings">
        <div class="settings-box">
          <h3>Platform Settings</h3>
          <label>Organization Name</label>
          <input type="text" value="My University" disabled>
          <label>Brand Color</label>
          <input type="color" value="#1e90ff" disabled>
          <button class="btn" disabled>Save Changes</button>
        </div>
        <div class="settings-box">
          <h3>Admin Management</h3>
          <p>Feature Coming Soon!</p>
        </div>
      </section>
    </div>
  </main>
  <!-- [All modals as in previous file...] -->
  <div class="modal" id="election-modal">
    <div class="modal-content">
      <h2 id="election-modal-title">Add Election</h2>
      <form id="election-form" autocomplete="off">
        <input type="hidden" id="election-index">
        <label>Election Name
          <input type="text" id="election-name" required>
        </label>
        <label>Status
          <select id="election-status">
            <option value="Active">Active</option>
            <option value="Closed">Closed</option>
            <option value="Draft">Draft</option>
          </select>
        </label>
        <label>Start Date
          <input type="date" id="election-start" required>
        </label>
        <label>End Date
          <input type="date" id="election-end" required>
        </label>
        <div class="error" id="election-error"></div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="election-cancel">Cancel</button>
          <button type="submit" class="btn" id="election-save">Save</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal" id="election-confirm-modal">
    <div class="modal-content">
      <h2>Confirm Delete</h2>
      <p>Are you sure you want to delete this election?</p>
      <div class="modal-actions">
        <button class="btn secondary" id="election-delete-cancel">Cancel</button>
        <button class="btn danger" id="election-delete-confirm">Delete</button>
      </div>
    </div>
  </div>
  <div class="modal" id="candidate-modal">
    <div class="modal-content">
      <h2 id="candidate-modal-title">Add Candidate</h2>
      <form id="candidate-form" autocomplete="off">
        <input type="hidden" id="candidate-index">
        <label>Candidate Name
          <input type="text" id="candidate-name" required>
        </label>
        <label>Election
          <input type="text" id="candidate-election" required placeholder="Election name">
        </label>
        <label>Profile
          <input type="text" id="candidate-profile" required>
        </label>
        <label>Votes
          <input type="number" id="candidate-votes" required min="0" value="0">
        </label>
        <div class="error" id="candidate-error"></div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="candidate-cancel">Cancel</button>
          <button type="submit" class="btn" id="candidate-save">Save</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal" id="candidate-confirm-modal">
    <div class="modal-content">
      <h2>Confirm Delete</h2>
      <p>Are you sure you want to delete this candidate?</p>
      <div class="modal-actions">
        <button class="btn secondary" id="candidate-delete-cancel">Cancel</button>
        <button class="btn danger" id="candidate-delete-confirm">Delete</button>
      </div>
    </div>
  </div>
  <div class="modal" id="voter-modal">
    <div class="modal-content">
      <h2 id="voter-modal-title">Add Voter</h2>
      <form id="voter-form" autocomplete="off">
        <input type="hidden" id="voter-index">
        <label>Voter ID
          <input type="number" id="voter-id" required>
        </label>
        <label>Name
          <input type="text" id="voter-name" required>
        </label>
        <label>Status
          <select id="voter-status">
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>
        </label>
        <label>Voted
          <select id="voter-voted">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </label>
        <div class="error" id="voter-error"></div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="voter-cancel">Cancel</button>
          <button type="submit" class="btn" id="voter-save">Save</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal" id="voter-confirm-modal">
    <div class="modal-content">
      <h2>Confirm Delete</h2>
      <p>Are you sure you want to delete this voter?</p>
      <div class="modal-actions">
        <button class="btn secondary" id="voter-delete-cancel">Cancel</button>
        <button class="btn danger" id="voter-delete-confirm">Delete</button>
      </div>
    </div>
  </div>
  <script>
    // USER/ADMIN LOGIN NAME
    const currentAdmin = 'Richarddtimm230';

    // ------------------------------- ACTIVITY LOG -----------------------------------
    let adminLogs = [
      {ts:'2025-06-11 02:50:10',admin:currentAdmin,action:'Login',target:'',details:'Logged in successfully.'},
      {ts:'2025-06-11 02:51:00',admin:currentAdmin,action:'Create Election',target:'School President 2025',details:'Election created.'},
      {ts:'2025-06-11 02:51:30',admin:currentAdmin,action:'Edit Candidate',target:'Jane Doe',details:'Profile updated.'},
      {ts:'2025-06-11 02:51:40',admin:currentAdmin,action:'Delete Voter',target:'Voter ID 103',details:'Voter removed.'},
      {ts:'2025-06-11 02:52:00',admin:currentAdmin,action:'Settings Change',target:'Platform',details:'Changed brand color.'},
    ];
    function logAdminAction(action, target, details) {
      const now = new Date();
      const ts = now.getFullYear() + '-' +
        String(now.getMonth()+1).padStart(2,'0') + '-' +
        String(now.getDate()).padStart(2,'0') + ' ' +
        String(now.getHours()).padStart(2,'0') + ':' +
        String(now.getMinutes()).padStart(2,'0') + ':' +
        String(now.getSeconds()).padStart(2,'0');
      adminLogs.unshift({
        ts,
        admin: currentAdmin,
        action,
        target,
        details
      });
      renderAdminLogTable(getCurrentAdminLogFilter());
    }
    function getCurrentAdminLogFilter() {
      return {
        text: document.getElementById('admin-log-search').value.trim().toLowerCase(),
        date: document.getElementById('admin-log-date').value
      };
    }
    function renderAdminLogTable(filter = {text:'',date:''}) {
      const tbody = document.getElementById('activity-log-table');
      tbody.innerHTML = '';
      let filtered = adminLogs.filter(log => {
        let matchesText = filter.text === '' ||
          [log.action, log.admin, log.target, log.details].some(f =>
            String(f).toLowerCase().includes(filter.text)
          );
        let matchesDate = filter.date === '' ||
          log.ts.startsWith(filter.date);
        return matchesText && matchesDate;
      });
      if(filtered.length === 0){
        tbody.innerHTML = `<tr><td colspan="5" style="color:#7d8ca9;text-align:center;">No log entries found.</td></tr>`;
        return;
      }
      filtered.forEach(log => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${log.ts}</td>
                        <td>${log.admin}</td>
                        <td>${log.action}</td>
                        <td>${log.target}</td>
                        <td>${log.details}</td>`;
        tbody.appendChild(tr);
      });
    }
    renderAdminLogTable();

    document.getElementById('admin-log-search').addEventListener('input', ()=> renderAdminLogTable(getCurrentAdminLogFilter()));
    document.getElementById('admin-log-date').addEventListener('change', ()=> renderAdminLogTable(getCurrentAdminLogFilter()));

    document.getElementById('export-log-btn').onclick = function(){
      let rows = [['Timestamp','Admin','Action','Target','Details']];
      let filter = getCurrentAdminLogFilter();
      let filtered = adminLogs.filter(log => {
        let matchesText = filter.text === '' ||
          [log.action, log.admin, log.target, log.details].some(f =>
            String(f).toLowerCase().includes(filter.text)
          );
        let matchesDate = filter.date === '' ||
          log.ts.startsWith(filter.date);
        return matchesText && matchesDate;
      });
      filtered.forEach(log =>
        rows.push([log.ts,log.admin,log.action,log.target,log.details])
      );
      let csv = rows.map(r => r.map(x => `"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      let blob = new Blob([csv], {type:'text/csv'});
      let a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'admin-activity-log.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    };

    // ------------------------------- NAVIGATION -----------------------------------
    document.querySelectorAll('.sidebar ul li a').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.sidebar ul li a').forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        var section = this.getAttribute('data-section');
        document.querySelectorAll('.container > section').forEach(sec => sec.classList.remove('active'));
        document.getElementById(section).classList.add('active');
        document.getElementById('section-title').textContent = this.textContent.replace(/^\s*[\S]+\s*/, '');
      });
    });

    // ------------------------------- DASHBOARD -----------------------------------
    const dashboardStats = { activeElections: 2, totalVoters: 1245, votesCast: 860 };
    document.getElementById('active-elections').textContent = dashboardStats.activeElections;
    document.getElementById('total-voters').textContent = dashboardStats.totalVoters;
    document.getElementById('votes-cast').textContent = dashboardStats.votesCast;
    document.getElementById('turnout-rate').textContent = Math.round((dashboardStats.votesCast / dashboardStats.totalVoters) * 100) + "%";
    // Recent
    const recent = [
      "Election <b>'School President 2025'</b> was created.",
      "<b>Jane Doe</b> added as candidate.",
      "New voter list imported.",
      "Results exported for <b>'Science Club Election'</b>.",
      "<b>John Doe</b> attempted duplicate vote (blocked)."
    ];
    const recentList = document.getElementById('recent-activity');
    recent.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `<span class="dot"></span> ${item}`;
      recentList.appendChild(li);
    });

    // ------------------------------- ELECTIONS CRUD -----------------------------------
    let elections = [
      { name: "School President 2025", status: "Active", start: "2025-06-10", end: "2025-06-12" },
      { name: "Science Club Election", status: "Closed", start: "2025-05-01", end: "2025-05-02" }
    ];
    let electionToDelete = null;
    // Replace your renderElectionsTable() function with the following:

function renderElectionsTable(filter="") {
  const table = document.getElementById('elections-table');
  table.innerHTML = "";
  elections.filter(e => Object.values(e).some(v => String(v).toLowerCase().includes(filter.toLowerCase())))
    .forEach((e, idx) => {
      let tr = document.createElement('tr');
      tr.innerHTML = `<td>${e.name}</td>
        <td>${e.status === "Active" ? `<span style="color:var(--success);font-weight:600">${e.status}</span>` : e.status}</td>
        <td>${e.start}</td>
        <td>${e.end}</td>
        <td class="action-btns">
          <button class="btn small" onclick="showEditElectionModal(${idx})">Edit</button>
          <button class="btn small danger" onclick="showDeleteElectionModal(${idx})">Delete</button>
          <a class="btn small secondary" href="election-report.html?election=${encodeURIComponent(e.name)}">View</a>
        </td>`;
      table.appendChild(tr);
    });
    }
    
    renderElectionsTable();
    document.getElementById('election-search').addEventListener('input', e => { renderElectionsTable(e.target.value); });
    // Election Modal logic
    const electionModal = document.getElementById('election-modal');
    const electionConfirmModal = document.getElementById('election-confirm-modal');
    function showElectionModal(editIdx = null) {
      electionModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      document.getElementById('election-error').style.display = 'none';
      if (editIdx !== null) {
        document.getElementById('election-modal-title').textContent = "Edit Election";
        document.getElementById('election-index').value = editIdx;
        const e = elections[editIdx];
        document.getElementById('election-name').value = e.name;
        document.getElementById('election-status').value = e.status;
        document.getElementById('election-start').value = e.start;
        document.getElementById('election-end').value = e.end;
      } else {
        document.getElementById('election-modal-title').textContent = "Add Election";
        document.getElementById('election-index').value = "";
        document.getElementById('election-name').value = "";
        document.getElementById('election-status').value = "Active";
        document.getElementById('election-start').value = "";
        document.getElementById('election-end').value = "";
      }
    }
    function hideElectionModal() {
      electionModal.classList.remove('active');
      document.body.style.overflow = '';
      document.getElementById('election-form').reset();
    }
    function showEditElectionModal(idx) { showElectionModal(idx);}
    document.getElementById('add-election-btn').onclick = () => showElectionModal();
    document.getElementById('election-cancel').onclick = hideElectionModal;
    document.getElementById('election-form').onsubmit = function(e) {
      e.preventDefault();
      const idx = document.getElementById('election-index').value;
      const name = document.getElementById('election-name').value.trim();
      const status = document.getElementById('election-status').value;
      const start = document.getElementById('election-start').value;
      const end = document.getElementById('election-end').value;
      const errorDiv = document.getElementById('election-error');
      if (!name || !start || !end) {
        errorDiv.textContent = "Please fill all fields.";
        errorDiv.style.display = 'block';
        return;
      }
      if (end < start) {
        errorDiv.textContent = "End date cannot be before start date.";
        errorDiv.style.display = 'block';
        return;
      }
      if (elections.some((el, i) => el.name.toLowerCase() === name.toLowerCase() && String(i) !== idx)) {
        errorDiv.textContent = "An election with this name already exists.";
        errorDiv.style.display = 'block';
        return;
      }
      if (idx) {
        elections[idx] = { name, status, start, end };
        logAdminAction('Edit Election', name, `Election updated: status=${status}, start=${start}, end=${end}`);
      } else {
        elections.push({ name, status, start, end });
        logAdminAction('Create Election', name, `Election created.`);
      }
      hideElectionModal();
      renderElectionsTable(document.getElementById('election-search').value);
    };
    function showDeleteElectionModal(idx) {
      electionToDelete = idx;
      electionConfirmModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function hideElectionConfirmModal() {
      electionConfirmModal.classList.remove('active');
      document.body.style.overflow = '';
    }
    document.getElementById('election-delete-cancel').onclick = hideElectionConfirmModal;
    document.getElementById('election-delete-confirm').onclick = function() {
      if (electionToDelete !== null) {
        logAdminAction('Delete Election', elections[electionToDelete].name, 'Election deleted.');
        elections.splice(electionToDelete, 1);
        renderElectionsTable(document.getElementById('election-search').value);
      }
      hideElectionConfirmModal();
      electionToDelete = null;
    };

    // ------------------------------- CANDIDATES CRUD -----------------------------------
    let candidates = [
      { name: "Jane Doe", election: "School President 2025", profile: "Vision for school", votes: 420 },
      { name: "John Smith", election: "School President 2025", profile: "Student leader", votes: 392 }
    ];
    let candidateToDelete = null;
    function renderCandidatesTable(filter="") {
      const table = document.getElementById('candidates-table');
      table.innerHTML = "";
      candidates.filter(c => Object.values(c).some(v => String(v).toLowerCase().includes(filter.toLowerCase())))
        .forEach((c, idx) => {
          let tr = document.createElement('tr');
          tr.innerHTML = `<td>${c.name}</td>
            <td>${c.election}</td>
            <td>${c.profile}</td>
            <td>${c.votes}</td>
            <td class="action-btns">
              <button class="btn small" onclick="showEditCandidateModal(${idx})">Edit</button>
              <button class="btn small danger" onclick="showDeleteCandidateModal(${idx})">Delete</button>
            </td>`;
          table.appendChild(tr);
        });
    }
    renderCandidatesTable();
    document.getElementById('candidate-search').addEventListener('input', e => { renderCandidatesTable(e.target.value); });
    const candidateModal = document.getElementById('candidate-modal');
    const candidateConfirmModal = document.getElementById('candidate-confirm-modal');
    function showCandidateModal(editIdx = null) {
      candidateModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      document.getElementById('candidate-error').style.display = 'none';
      if (editIdx !== null) {
        document.getElementById('candidate-modal-title').textContent = "Edit Candidate";
        document.getElementById('candidate-index').value = editIdx;
        const c = candidates[editIdx];
        document.getElementById('candidate-name').value = c.name;
        document.getElementById('candidate-election').value = c.election;
        document.getElementById('candidate-profile').value = c.profile;
        document.getElementById('candidate-votes').value = c.votes;
      } else {
        document.getElementById('candidate-modal-title').textContent = "Add Candidate";
        document.getElementById('candidate-index').value = "";
        document.getElementById('candidate-name').value = "";
        document.getElementById('candidate-election').value = "";
        document.getElementById('candidate-profile').value = "";
        document.getElementById('candidate-votes').value = "0";
      }
    }
    function hideCandidateModal() {
      candidateModal.classList.remove('active');
      document.body.style.overflow = '';
      document.getElementById('candidate-form').reset();
    }
    function showEditCandidateModal(idx) { showCandidateModal(idx);}
    document.getElementById('add-candidate-btn').onclick = () => showCandidateModal();
    document.getElementById('candidate-cancel').onclick = hideCandidateModal;
    document.getElementById('candidate-form').onsubmit = function(e) {
      e.preventDefault();
      const idx = document.getElementById('candidate-index').value;
      const name = document.getElementById('candidate-name').value.trim();
      const election = document.getElementById('candidate-election').value.trim();
      const profile = document.getElementById('candidate-profile').value.trim();
      const votes = document.getElementById('candidate-votes').value.trim();
      const errorDiv = document.getElementById('candidate-error');
      if (!name || !election || !profile || votes === "") {
        errorDiv.textContent = "Please fill all fields.";
        errorDiv.style.display = 'block';
        return;
      }
      if (candidates.some((el, i) => el.name.toLowerCase() === name.toLowerCase() && el.election.toLowerCase() === election.toLowerCase() && String(i) !== idx)) {
        errorDiv.textContent = "A candidate with this name already exists for this election.";
        errorDiv.style.display = 'block';
        return;
      }
      if (idx) {
        candidates[idx] = { name, election, profile, votes: Number(votes) };
        logAdminAction('Edit Candidate', name, `Candidate updated: election=${election}, profile=${profile}, votes=${votes}`);
      } else {
        candidates.push({ name, election, profile, votes: Number(votes) });
        logAdminAction('Create Candidate', name, `Candidate created for election: ${election}`);
      }
      hideCandidateModal();
      renderCandidatesTable(document.getElementById('candidate-search').value);
    };
    function showDeleteCandidateModal(idx) {
      candidateToDelete = idx;
      candidateConfirmModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function hideCandidateConfirmModal() {
      candidateConfirmModal.classList.remove('active');
      document.body.style.overflow = '';
    }
    document.getElementById('candidate-delete-cancel').onclick = hideCandidateConfirmModal;
    document.getElementById('candidate-delete-confirm').onclick = function() {
      if (candidateToDelete !== null) {
        logAdminAction('Delete Candidate', candidates[candidateToDelete].name, 'Candidate deleted.');
        candidates.splice(candidateToDelete, 1);
        renderCandidatesTable(document.getElementById('candidate-search').value);
      }
      hideCandidateConfirmModal();
      candidateToDelete = null;
    };

    let voters = [
      { id: 101, name: "John Doe", status: "Active", voted: "Yes", votedVia: "Paper", timestamp: "2025-06-11 10:30" },
      { id: 102, name: "Jane Smith", status: "Active", voted: "No" }
    ];
    let voterToMark = null;
    function renderVotersTable(filter = "") {
      const table = document.getElementById('voters-table');
      table.innerHTML = "";
      voters.filter(v => Object.values(v).some(val => String(val).toLowerCase().includes(filter.toLowerCase())))
        .forEach((v, idx) => {
          let markBtn = "";
          if (v.voted === "No") {
            markBtn = `<button class="btn small" onclick="showMarkVotedConfirmModal(${idx})">Mark as Voted</button>`;
          } else {
            markBtn = `<span style="color:var(--success);font-weight:600;">&#10004; Voted</span>`;
          }
          let votedVia = v.votedVia ? v.votedVia : "-";
          let tr = document.createElement('tr');
          tr.innerHTML = `<td>${v.id}</td>
            <td>${v.name}</td>
            <td>${v.status === "Active" ? `<span style="color:var(--success);font-weight:600">${v.status}</span>` : `<span style="color:var(--danger);font-weight:600">${v.status}</span>`}</td>
            <td>${v.voted === "Yes" ? `<span style="color:var(--primary);font-weight:600">${v.voted}</span>` : v.voted}</td>
            <td>${votedVia}</td>
            <td class="action-btns">
              <button class="btn small" onclick="showEditVoterModal(${idx})">Edit</button>
              <button class="btn small danger" onclick="showDeleteVoterModal(${idx})">Delete</button>
              ${markBtn}
            </td>`;
          table.appendChild(tr);
        });
    }
    function showMarkVotedConfirmModal(idx) {
      voterToMark = idx;
      document.getElementById("confirm-voter-name").textContent = voters[idx].name;
      document.getElementById("mark-voted-confirm-modal").classList.add("active");
      document.body.style.overflow = 'hidden';
    }
    function hideMarkVotedConfirmModal() {
      document.getElementById("mark-voted-confirm-modal").classList.remove("active");
      document.body.style.overflow = '';
      voterToMark = null;
    }
    document.getElementById('mark-voted-cancel').onclick = hideMarkVotedConfirmModal;
    document.getElementById('mark-voted-confirm').onclick = function() {
      if (voterToMark !== null) {
        voters[voterToMark].voted = "Yes";
        voters[voterToMark].votedVia = "Paper";
        voters[voterToMark].timestamp = new Date().toISOString().slice(0, 16).replace('T', ' ');
        renderVotersTable(document.getElementById('voter-search').value);
        logAdminAction?.('Mark as Voted (Paper)', voters[voterToMark].name, `Voter marked as voted via paper ballot.`);
      }
      hideMarkVotedConfirmModal();
    };
    window.onclick = function(event) {
      if (event.target === document.getElementById("mark-voted-confirm-modal")) hideMarkVotedConfirmModal();
      // ...Other modal close handlers...
    };
    renderVotersTable();
    document.getElementById('voter-search').addEventListener('input', e => { renderVotersTable(e.target.value); });
    const voterModal = document.getElementById('voter-modal');
    const voterConfirmModal = document.getElementById('voter-confirm-modal');
    function showVoterModal(editIdx = null) {
      voterModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      document.getElementById('voter-error').style.display = 'none';
      if (editIdx !== null) {
        document.getElementById('voter-modal-title').textContent = "Edit Voter";
        document.getElementById('voter-index').value = editIdx;
        const v = voters[editIdx];
        document.getElementById('voter-id').value = v.id;
        document.getElementById('voter-name').value = v.name;
        document.getElementById('voter-status').value = v.status;
        document.getElementById('voter-voted').value = v.voted;
      } else {
        document.getElementById('voter-modal-title').textContent = "Add Voter";
        document.getElementById('voter-index').value = "";
        document.getElementById('voter-id').value = "";
        document.getElementById('voter-name').value = "";
        document.getElementById('voter-status').value = "Active";
        document.getElementById('voter-voted').value = "No";
      }
    }
    function hideVoterModal() {
      voterModal.classList.remove('active');
      document.body.style.overflow = '';
      document.getElementById('voter-form').reset();
    }
    function showEditVoterModal(idx) { showVoterModal(idx);}
    document.getElementById('add-voter-btn').onclick = () => showVoterModal();
    document.getElementById('voter-cancel').onclick = hideVoterModal;
    document.getElementById('voter-form').onsubmit = function(e) {
      e.preventDefault();
      const idx = document.getElementById('voter-index').value;
      const id = document.getElementById('voter-id').value.trim();
      const name = document.getElementById('voter-name').value.trim();
      const status = document.getElementById('voter-status').value;
      const voted = document.getElementById('voter-voted').value;
      const errorDiv = document.getElementById('voter-error');
      if (!id || !name) {
        errorDiv.textContent = "Please fill all fields.";
        errorDiv.style.display = 'block';
        return;
      }
      if (voters.some((el, i) => String(el.id) === id && String(i) !== idx)) {
        errorDiv.textContent = "A voter with this ID already exists.";
        errorDiv.style.display = 'block';
        return;
      }
      if (idx) {
        voters[idx] = { id: Number(id), name, status, voted };
        logAdminAction('Edit Voter', name, `Voter updated: id=${id}, status=${status}, voted=${voted}`);
      } else {
        voters.push({ id: Number(id), name, status, voted });
        logAdminAction('Create Voter', name, `Voter added: id=${id}, status=${status}, voted=${voted}`);
      }
      hideVoterModal();
      renderVotersTable(document.getElementById('voter-search').value);
    };
    function showDeleteVoterModal(idx) {
      voterToDelete = idx;
      voterConfirmModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function hideVoterConfirmModal() {
      voterConfirmModal.classList.remove('active');
      document.body.style.overflow = '';
    }
    document.getElementById('voter-delete-cancel').onclick = hideVoterConfirmModal;
    document.getElementById('voter-delete-confirm').onclick = function() {
      if (voterToDelete !== null) {
        logAdminAction('Delete Voter', voters[voterToDelete].name, `Voter deleted (id=${voters[voterToDelete].id}).`);
        voters.splice(voterToDelete, 1);
        renderVotersTable(document.getElementById('voter-search').value);
      }
      hideVoterConfirmModal();
      voterToDelete = null;
    };
    // ------------------------------- RESULTS -----------------------------------
    const results = [
      { election: "School President 2025", candidate: "Jane Doe", votes: 420 },
      { election: "School President 2025", candidate: "John Smith", votes: 392 }
    ];
    function renderResultsTable(filter = "") {
      const table = document.getElementById('results-table');
      table.innerHTML = "";
      results.filter(r => Object.values(r).some(val => String(val).toLowerCase().includes(filter.toLowerCase())))
        .forEach(r => {
          let tr = document.createElement('tr');
          tr.innerHTML = `<td>${r.election}</td><td>${r.candidate}</td><td>${r.votes}</td>`;
          table.appendChild(tr);
        });
    }
    renderResultsTable();
    document.getElementById('results-search').addEventListener('input', e => { renderResultsTable(e.target.value); });

    // ------------------------------- VOTER LOGS -----------------------------------
    const logs = [
      { voterId: 101, name: "John Doe", election: "School President 2025", action: "Voted", timestamp: "2025-06-10 09:03", status: "Success" },
      { voterId: 101, name: "John Doe", election: "School President 2025", action: "Voted", timestamp: "2025-06-10 09:10", status: "Duplicate Blocked" },
      { voterId: 102, name: "Jane Smith", election: "School President 2025", action: "Voted", timestamp: "2025-06-10 09:15", status: "Success" }
    ];
    function renderLogs(filter = "") {
      const table = document.getElementById('logs-table');
      table.innerHTML = "";
      logs.filter(log => Object.values(log).some(val => String(val).toLowerCase().includes(filter.toLowerCase())))
        .forEach(log => {
          const tr = document.createElement('tr');
          Object.values(log).forEach(val => {
            const td = document.createElement('td');
            td.textContent = val;
            tr.appendChild(td);
          });
          if(log.status === "Duplicate Blocked") tr.classList.add('duplicate');
          if(log.status === "Success") tr.classList.add('success');
          table.appendChild(tr);
        });
    }
    renderLogs();
    document.getElementById('log-search').addEventListener('input', e => { renderLogs(e.target.value); });

    // ------------------------------- CLOSE MODALS ON OUTSIDE CLICK -----------------------------------
    window.onclick = function(event) {
      if (event.target === electionModal) hideElectionModal();
      if (event.target === electionConfirmModal) hideElectionConfirmModal();
      if (event.target === candidateModal) hideCandidateModal();
      if (event.target === candidateConfirmModal) hideCandidateConfirmModal();
      if (event.target === voterModal) hideVoterModal();
      if (event.target === voterConfirmModal) hideVoterConfirmModal();
    };
  </script>
</body>
</html>
