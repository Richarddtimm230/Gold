<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gold and Linc Schools - Report Card</title>
<link rel="stylesheet" href="report.css">
  <style>
.report-container {
  background: #fff;
  max-width: 850px;
  min-width: 750px;
  width: 850px;
  min-height: 1100px;
  max-height: 1200px;
  height: 1200px;
  margin: 20px auto;
  border: 1.5px solid #0c4e8c;
  border-radius: 10px;
  box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);
  padding: 28px 26px 15px 26px;
  box-sizing: border-box;
  overflow: hidden;
  position: relative;
  page-break-after: avoid;
}

.background-blur {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 60%; /* Scale to container */
  height: 60%;
  transform: translate(-50%, -50%);
  filter: blur(30px);
  opacity: 0.08;
  z-index: 0;
  pointer-events: none;
}


.seal-container {
  position: relative;
  display: flex;
  justify-content: center;
  margin-top: 40px;
}

.seal-container img {
  height: 80px;
  width: auto;
}

  </style>
  <!-- jsPDF CDN and html2canvas for DOM rendering -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="report-container" id="reportCardDom">
    <img class="background-blur" src="logo-1679575828 (1).jpeg" alt="Blurred background">
    <button class="no-print-btn" onclick="downloadPDF()">Download as PDF</button>
    <header>
      <div class="school-header">
        <img src="logo-1679575828 (1).jpeg" alt="Golding Schools Logo" class="school-logo">
        <div class="school-info">
          <h1>GOLD AND LINC SCHOOLS</h1>
          <p>
            <span class="address">BEHIND IRENITEMI HOTEL, TESTING GROUND AREA, OFF OSOGBO ROAD, ILESA.</span><br>
            <span class="web">Website: goldlincschools.com</span>
            <span class="phone">Phone : 08034430941</span><br>
            <span class="email">Email : goldlincschool@gmail.com</span><br>
            <span class="motto">Motto : FOR A SOLID BEGINNING...</span>
          </p>
        </div>
        <img src="images (7).jpeg" alt="Nigeria Coat of Arms" class="coat-of-arms">
      </div>
      <div class="term-title">
        <h2 id="termTitle">FIRST TERM, 2024-2025 (END OF TERM REPORT)</h2>
      </div>
    </header>
    <section class="student-info-section">
      <table class="student-info-table" id="studentInfoTable">
        <tr>
          <td><strong>Name:</strong> <span id="stuName">OLAREWAJU TESTIMONY</span></td>
          <td><strong>Performance Grade:</strong> <span id="perfGrade">A (Excellent)</span></td>
        </tr>
        <tr>
          <td><strong>Reg. No:</strong> <span id="stuRegNo">2024/000838</span></td>
          <td><strong>Class Size:</strong> <span id="classSize">17</span></td>
        </tr>
        <tr>
          <td><strong>Gender:</strong> <span id="stuGender">F</span></td>
          <td><strong>No. of Subjects:</strong> <span id="numSubjects">13</span></td>
        </tr>
        <tr>
          <td><strong>Age:</strong> <span id="stuAge">11</span></td>
          <td><strong>Student Total Score:</strong> <span id="stuTotalScore">911 / 1300</span></td>
        </tr>
        <tr>
          <td><strong>DOB:</strong> <span id="stuDOB">17-03-2013</span></td>
          <td><strong>Student Average (%):</strong> <span id="stuAverage">70.08%</span></td>
        </tr>
        <tr>
          <td><strong>Class:</strong> <span id="stuClass">JSS2 - A</span></td>
          <td><strong>Grade Point Average:</strong> <span id="stuGPA">4.38</span></td>
        </tr>
        <tr>
          <td><strong>Email:</strong> <span id="stuEmail">testimony.olarewaju@goldlincschools.com</span></td>
          <td><strong>Result Summary:</strong> <span id="resultSummary">Excellent</span></td>
        </tr>
      </table>
    </section>
    <section class="results-section">
      <table class="results-table" id="resultsTable">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Continuous Assessment</th>
            <th>Mid Term Test</th>
            <th>Examination</th>
            <th>Total Score</th>
            <th>Score Grade</th>
            <th>Grade Remark</th>
            <th>Grade Points</th>
            <th>Teacher's Comment / Progress Report</th>
          </tr>
        </thead>
        <tbody>
          <!-- Populated by JS -->
        </tbody>
      </table>
    </section>
    <section class="skills-tables-section">
      <table class="skills-table affective-skills" id="affectiveSkillsTable">
        <thead>
          <tr>
            <th colspan="2">Affective Skills Rating (5)</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Punctuality</td><td>3</td></tr>
          <tr><td>Attentiveness</td><td>3</td></tr>
          <tr><td>Neatness</td><td>3</td></tr>
          <tr><td>Honesty</td><td>3</td></tr>
          <tr><td>Politeness</td><td>3</td></tr>
          <tr><td>Perseverance</td><td>3</td></tr>
          <tr><td>Relationship with Others</td><td>3</td></tr>
          <tr><td>Organization Ability</td><td>3</td></tr>
        </tbody>
      </table>
      <table class="skills-table psychomotor-skills" id="psychomotorSkillsTable">
        <thead>
          <tr>
            <th colspan="2">Psychomotor Skills Rating (5)</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Hand Writing</td><td>3</td></tr>
          <tr><td>Drawing and Painting</td><td>3</td></tr>
          <tr><td>Speech / Verbal Fluency</td><td>3</td></tr>
          <tr><td>Quantitative Reasoning</td><td>3</td></tr>
          <tr><td>Processing Speed</td><td>3</td></tr>
          <tr><td>Retentiveness</td><td>3</td></tr>
          <tr><td>Visual Memory</td><td>3</td></tr>
          <tr><td>Public Speaking</td><td>3</td></tr>
          <tr><td>Sports and Games</td><td>3</td></tr>
        </tbody>
      </table>
      <table class="skills-table attendance" id="attendanceTable">
        <thead>
          <tr>
            <th colspan="2">Attendance Report</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>No. of School Days</td><td>126</td></tr>
          <tr><td>No. of Days Present</td><td>122</td></tr>
          <tr><td>No. of Days Absent</td><td>4</td></tr>
          <tr><td>% Attendance</td><td>96.83%</td></tr>
        </tbody>
      </table>
    </section>
    <section class="grades-key-section">
      <table class="grades-key-table">
        <tr>
          <th>Key to Grades</th>
          <td>70-100: <strong>A</strong></td>
          <td>60-69: <strong>B</strong></td>
          <td>50-59: <strong>C</strong></td>
          <td>45-49: <strong>D</strong></td>
          <td>40-44: <strong>E</strong></td>
          <td>0-39: <strong>F</strong></td>
        </tr>
        <tr>
          <td></td>
          <td>Excellent<br>5 Grade Points.</td>
          <td>Very Good<br>4 Grade Points.</td>
          <td>Good<br>3 Grade Points.</td>
          <td>Pass<br>2 Grade Points.</td>
          <td>Poor<br>1 Grade Point.</td>
          <td>Fail<br>0 Grade Points.</td>
        </tr>
      </table>
    </section>
    <section class="comments-section">
      <p class="principal-comment">
        <strong>Principal's Comment :</strong> <span id="principalComment">This is an excellent result, do not rest on your oars.</span>
      </p>
      <div class="principal-sign">
        <span><strong>Principal:</strong> <span id="principalName">ABIODUN FESTUS ADENIYI</span></span>
        <span><strong>Principal's Signature :</strong> ____________________</span>
      </div>
    </section>
    <section class="footer-section">
      <div class="next-term">
        <strong>Next Term Begins:</strong> <span class="next-term-date" id="nextTermDate">Monday 6th of January 2025.</span>
      </div>
      <div class="footer-meta">
        <span id="printDate">Printed : 18-12-2024 02:53 pm</span>
              </div>
    </section>
    <div class="seal-container">
  <img src="images (6).jpeg" alt="Red Seal" />
  </div>
  
  </div>
<script>
  function getFormattedPrintDate() {
    const now = new Date();
    const dd = now.getDate().toString().padStart(2,'0');
    const mm = (now.getMonth()+1).toString().padStart(2,'0');
    const yyyy = now.getFullYear();
    let h = now.getHours();
    let ampm = "am";
    if (h > 12) { h = h - 12; ampm = "pm"; }
    else if (h === 0) { h = 12; }
    const min = now.getMinutes().toString().padStart(2,'0');
    return `Printed : ${dd}-${mm}-${yyyy} ${h}:${min} ${ampm}`;
  }

  function formatDate(d) {
    try {
      const date = new Date(d);
      return date.toLocaleDateString();
    } catch {
      return d;
    }
  }
function fillReport() {
  const dataStr = sessionStorage.getItem("reportData");
  if (!dataStr) return;
  const data = JSON.parse(dataStr);

  if (data.term && data.session) {
    document.getElementById("termTitle").innerText = `${data.term}, ${data.session} (END OF TERM REPORT)`;
  }

  if (data.student) {
    document.getElementById("stuName").innerText = data.student.name || "";
    document.getElementById("stuRegNo").innerText = data.student.regNo || data.regNo || "";
    document.getElementById("stuGender").innerText = data.student.gender || "";
    document.getElementById("stuDOB").innerText = formatDate(data.student.dob || data.student.DOB || "");
    document.getElementById("stuEmail").innerText = data.student.studentEmail || data.student.email || "";
    document.getElementById("stuClass").innerText = data.class || "";
    if (data.student.age) document.getElementById("stuAge").innerText = data.student.age;
  } else {
    document.getElementById("stuRegNo").innerText = data.regNo || "";
    document.getElementById("stuClass").innerText = data.class || "";
  }

  if (data.classSize) document.getElementById("classSize").innerText = data.classSize;
  if (data.numSubjects) document.getElementById("numSubjects").innerText = data.numSubjects;
  if (data.principalComment) document.getElementById("principalComment").innerText = data.principalComment;
  if (data.principalName) document.getElementById("principalName").innerText = data.principalName;
  if (data.nextTermDate) document.getElementById("nextTermDate").innerText = data.nextTermDate;

  const tbody = document.querySelector("#resultsTable tbody");
  let totalScore = 0;
  let totalGradePoints = 0;
  let subjectCount = 0;
  const maxPerSubject = 100;

  if (tbody && Array.isArray(data.results)) {
    tbody.innerHTML = data.results.map(res => {
      const ca1 = parseFloat(res.ca1_score || 0);
      const ca2 = parseFloat(res.ca2_score || 0);
      const mid = parseFloat(res.midterm_score || 0);
      const exam = parseFloat(res.exam_score || 0);
      const total = ca1 + ca2 + mid + exam;

      const gradePoint = parseFloat(res.grade_point || 0);
      totalScore += total;
      totalGradePoints += gradePoint;
      subjectCount++;

      return `
        <tr>
          <td>${res.subject || ""}</td>
          <td>${ca1 + ca2}</td>
          <td>${res.midterm_score !== undefined ? res.midterm_score : ""}</td>
          <td>${res.exam_score !== undefined ? res.exam_score : ""}</td>
          <td>${res.total !== undefined ? res.total : total}</td>
          <td>${res.grade || ""}</td>
          <td>${res.remarks || res.remark || ""}</td>
          <td>${res.grade_point || ""}</td>
          <td>${res.teacher_comment || res.comment || ""}</td>
        </tr>
      `;
    }).join('');
  }

  const maxTotal = subjectCount * maxPerSubject;
  const avgScore = subjectCount > 0 ? (totalScore / subjectCount) : 0;
  const gpa = subjectCount > 0 ? (totalGradePoints / subjectCount) : 0;

  // Auto-grade based on average score
  let perfGrade = "";
  if (avgScore >= 70) perfGrade = "A (Excellent)";
  else if (avgScore >= 60) perfGrade = "B (Very Good)";
  else if (avgScore >= 50) perfGrade = "C (Good)";
  else if (avgScore >= 45) perfGrade = "D (Pass)";
  else if (avgScore >= 40) perfGrade = "E (Poor)";
  else perfGrade = "F (Fail)";

  // Auto-remark based on GPA
  let gpaRemark = "";
  if (gpa >= 4.5) gpaRemark = "Excellent";
  else if (gpa >= 3.5) gpaRemark = "Very Good";
  else if (gpa >= 2.5) gpaRemark = "Good";
  else if (gpa >= 1.5) gpaRemark = "Pass";
  else if (gpa > 0) gpaRemark = "Poor";
  else gpaRemark = "Fail";

  document.getElementById("stuTotalScore").innerText = `${totalScore} / ${maxTotal}`;
  document.getElementById("stuAverage").innerText = `${avgScore.toFixed(2)}%`;
  document.getElementById("stuGPA").innerText = gpa.toFixed(2);
  document.getElementById("perfGrade").innerText = perfGrade;
  document.getElementById("resultSummary").innerText = gpaRemark;

  if (data.affectiveSkills && Array.isArray(data.affectiveSkills)) {
    const rows = data.affectiveSkills.map(sk => `<tr><td>${sk.name}</td><td>${sk.score}</td></tr>`).join('');
    document.querySelector("#affectiveSkillsTable tbody").innerHTML = rows;
  }
  if (data.psychomotorSkills && Array.isArray(data.psychomotorSkills)) {
    const rows = data.psychomotorSkills.map(sk => `<tr><td>${sk.name}</td><td>${sk.score}</td></tr>`).join('');
    document.querySelector("#psychomotorSkillsTable tbody").innerHTML = rows;
  }
  if (data.attendance && Array.isArray(data.attendance)) {
    const rows = data.attendance.map(a => `<tr><td>${a.label}</td><td>${a.value}</td></tr>`).join('');
    document.querySelector("#attendanceTable tbody").innerHTML = rows;
  }

  document.getElementById("printDate").innerText = getFormattedPrintDate();
}

  
  window.addEventListener('DOMContentLoaded', fillReport);

    // jsPDF download logic
  async function downloadPDF() {
    const reportDom = document.getElementById('reportCardDom');
    // Optionally hide button for snapshot
    document.querySelector('.no-print-btn').style.visibility = 'hidden';
    // Wait for styles to apply, then snapshot
    await new Promise(r => setTimeout(r, 250));
    html2canvas(reportDom, {scale:2, useCORS:true, backgroundColor: "#fff"}).then(canvas => {
      const imgData = canvas.toDataURL('image/png');
      // A4 page = 210mm x 297mm, jsPDF units are 'mm'
      const pdf = new window.jspdf.jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: [297, 210] // height, width (jsPDF expects [height, width] for custom)
      });
      // Calculate image size to fit A4 in portrait
      const pageWidth = 210;
      const pageHeight = 297;
      // Make image fill the width, adjust height proportionally
      const imgWidth = pageWidth;
      const imgHeight = canvas.height * imgWidth / canvas.width;
      const yOffset = Math.max(0, (pageHeight-imgHeight)/2);
      pdf.addImage(imgData, 'PNG', 0, yOffset, imgWidth, imgHeight);
      pdf.save('ReportCard.pdf');
      document.querySelector('.no-print-btn').style.visibility = 'visible';
    }).catch(e=>{
      alert("Could not generate PDF: " + e.message);
      document.querySelector('.no-print-btn').style.visibility = 'visible';
    });
  }
</script>

</body>
</html>
