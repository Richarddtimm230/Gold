<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Dashboard | Gold and Linc Schools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Inter Font + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    :root {
      --primary: #143b6b;
      --accent: #ff9900;
      --bg: #f4f7fa;
      --card: #fff;
      --radius: 16px;
      --shadow: 0 2px 12px 0 rgba(20,59,107,0.07);
      --shadow-hover: 0 6px 22px 0 #ff990030;
      --text-main: #1b2532;
      --text-muted: #788;
      --nav: #fff;
      --nav-active: #143b6b;
      --nav-border: #e5e9f2;
      --transition: 0.17s cubic-bezier(.39,.58,.57,1.01);
    }
    html, body {
      margin: 0; padding: 0;
      background: var(--bg);
      font-family: 'Inter', Arial, sans-serif;
      color: var(--text-main);
      min-height: 100vh;
    }
    /* HEADER */
    .topbar {
      background: var(--primary);
      color: #fff;
      padding: 0.9rem 1rem 0.8rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(20,59,107,0.08);
      border-bottom-left-radius: 18px;
      border-bottom-right-radius: 18px;
    }
    .user-area {
      display: flex;
      align-items: center;
      gap: 13px;
    }
    .avatar {
      width: 38px; height: 38px; border-radius: 50%;
      object-fit: cover; background: #eaf2fb; border: 2px solid var(--accent);
    }
    .user-info {
      line-height: 1.15;
    }
    .user-info .name {
      font-weight: 700; font-size: 1.07rem;
    }
    .user-info .role {
      color: #ffedc2; font-size: 0.93rem;
    }
    .topbar-actions {
      display: flex; gap: 18px;
    }
    .topbar-actions .icon {
      font-size: 1.12rem;
      color: #ffedc2;
      cursor: pointer;
      transition: color var(--transition);
    }
    .topbar-actions .icon:hover { color: #fff; }
    /* MAIN DASH */
    .dashboard {
      width: 100%;
      max-width: 500px;
      margin: 0 auto 52px auto;
      padding: 16px 1vw 77px 1vw;
      box-sizing: border-box;
      transition: max-width 0.2s;
    }
    /* TIMETABLE */
    .timetable-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px 14px 13px 14px;
      text-align: center;
      margin-bottom: 13px;
      transition: box-shadow var(--transition), transform var(--transition);
    }
    .timetable-card .tt-title {
      font-weight: 700; font-size: 1.13rem; color: var(--primary);
      margin-bottom: 2px;
    }
    .timetable-card .tt-today {
      color: var(--accent); font-weight: 600; font-size: 1.05rem; margin-bottom: 4px;
      letter-spacing: 0.01em;
    }
    .timetable-card .tt-link {
      color: var(--primary); font-size: 0.98rem; text-decoration: underline; cursor:pointer;
      display: inline-block; margin-top: 2px;
      transition: color 0.12s;
    }
    .timetable-card .tt-link:hover { color: var(--accent);}
    /* GRID MENU */
    .menu-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 10px;
    }
    .menu-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 0 13px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      min-height: 78px;
      transition: box-shadow var(--transition), transform var(--transition), border var(--transition);
      border: 2px solid transparent;
    }
    .menu-card:hover, .menu-card:focus-visible {
      box-shadow: var(--shadow-hover);
      border: 2px solid var(--accent);
      transform: scale(1.028);
      outline: none;
    }
    .menu-card .icon {
      font-size: 1.4rem;
      color: var(--primary);
      margin-bottom: 6px;
      transition: color var(--transition);
    }
    .menu-card:hover .icon, .menu-card:focus-visible .icon { color: var(--accent);}
    .menu-card .label {
      font-weight: 600;
      font-size: 1.01rem;
      color: #243a5a;
      letter-spacing: 0.01em;
    }
    /* SECTION CARD */
    .section-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 12px 12px 13px;
      margin: 13px 0;
    }
    .section-title {
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }
    /* News & Updates */
    .news-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 12px 13px 13px;
      margin-bottom: 13px;
      margin-top: 13px;
    }
    .news-title {
      color: var(--primary);
      font-weight: 800;
      margin-bottom: 9px;
      font-size: 1.09rem;
    }
    .news-empty {
      color: #888;
      font-size: 0.97rem;
      margin-bottom: 6px;
      text-align: center;
      padding: 8px 0 3px 0;
    }
    .news-item {
      background: #eaf6ff;
      border-radius: 8px;
      padding: 10px 14px 9px 14px;
      margin-bottom: 8px;
      box-shadow: 0 1px 8px rgba(30,80,180,0.07);
      font-size: 1.01rem;
      transition: background var(--transition);
    }
    .news-item strong { color: var(--primary);}
    .news-item:hover { background: #f4f8fc;}
    .news-btn {
      background: linear-gradient(90deg, #eaf6fc 60%, #d5eafc 100%);
      border: none;
      color: #175b9c;
      font-size: 1.01rem;
      font-weight: 800;
      border-radius: 7px;
      padding: 9px 22px;
      cursor: pointer;
      margin: 2px auto 0 auto;
      display: block;
      transition: background var(--transition), color var(--transition), box-shadow var(--transition);
      box-shadow: 0 1px 6px rgba(30,80,180,0.07);
      letter-spacing: 0.02em;
    }
    .news-btn:hover { background: #17c3b2; color: #fff; box-shadow: 0 2px 16px #b2e9f4;}
    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: var(--nav);
      border-top: 1.5px solid var(--nav-border);
      height: 61px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 99;
      box-shadow: 0 -1px 12px 0 #e5e9f2;
      border-bottom-left-radius: 14px;
      border-bottom-right-radius: 14px;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 1.01rem;
      color: #8ca3c0;
      font-weight: 600;
      gap: 2px;
      padding: 5px 0 0 0;
      transition: color 0.13s;
      flex: 1 1 0;
      cursor: pointer;
    }
    .nav-item.active {
      color: var(--nav-active);
    }
    .nav-item .icon {
      font-size: 1.45rem;
    }
    /* TABLET STYLES */
    @media (min-width: 600px) and (max-width: 1030px) {
      .dashboard {
        max-width: 820px;
        padding-left: 2vw; padding-right: 2vw;
        display: grid;
        grid-template-columns: 2fr 1fr;
        grid-gap: 28px;
      }
      .dashboard > .timetable-card,
      .dashboard > .menu-grid,
      .dashboard > .section-card,
      .dashboard > .news-card {
        grid-column: 1 / 2;
      }
      .dashboard > .side-section {
        grid-column: 2 / 3;
      }
      .menu-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .bottom-nav { display: none; }
    }
    .side-section {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 11px 13px 13px;
      margin: 13px 0;
      min-height: 200px;
    }
    .side-section .section-title {
      font-size: 1.01rem;
      margin-bottom: 7px;
    }
    /* DESKTOP */
    @media (min-width: 1031px) {
      .dashboard {
        max-width: 1100px;
        padding: 30px 0 50px 0;
        display: grid;
        grid-template-columns: 2.4fr 1fr;
        gap: 42px;
        align-items: flex-start;
      }
      .dashboard > .timetable-card,
      .dashboard > .menu-grid,
      .dashboard > .section-card,
      .dashboard > .news-card {
        grid-column: 1 / 2;
      }
      .dashboard > .side-section {
        grid-column: 2 / 3;
      }
      .menu-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      .bottom-nav { display: none; }
      .topbar {
        max-width: 1100px;
        margin: 0 auto 0 auto;
        border-bottom-left-radius: 22px;
        border-bottom-right-radius: 22px;
      }
    }
    /* MOBILE ADJUSTMENTS */
    @media (max-width: 599px) {
      .dashboard {padding-left: 0; padding-right: 0;}
      .menu-grid {grid-template-columns: 1fr 1fr;}
      .topbar {padding: 0.9rem 0.7rem 0.8rem 0.7rem;}
      .section-card {padding: 13px 2vw 8px 2vw;}
      .side-section {padding: 13px 2vw 8px 2vw;}
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="topbar">
    <div class="user-area">
      <img class="avatar" id="profileAvatar" src="https://ui-avatars.com/api/?name=Student&background=ff9900&color=fff" alt="Student">
      <div class="user-info">
        <div class="name" id="profileName">STUDENT NAME</div>
        <div class="role">Student</div>
      </div>
    </div>
    <div class="topbar-actions">
      <span class="icon" title="Notifications"><i class="fa fa-bell"></i></span>
      <span class="icon" title="Menu"><i class="fa fa-ellipsis-v"></i></span>
    </div>
  </div>
  <!-- DASHBOARD BODY -->
  <div class="dashboard">
    <!-- Timetable -->
    <div class="timetable-card" id="timetableCard">
      <div class="tt-title">My Timetable</div>
      <div class="tt-today" id="ttToday">Loading...</div>
      <a class="tt-link" href="#" id="ttAllLink">See all Weekdays ▼</a>
    </div>
    <!-- Grid Menu -->
    <div class="menu-grid">
      <div class="menu-card" tabindex="0" onclick="window.location.href='e-class.html'">
        <span class="icon"><i class="fa fa-laptop"></i></span>
        <span class="label">E-Classroom</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='fees.html'">
        <span class="icon"><i class="fa fa-dollar-sign"></i></span>
        <span class="label">Fees</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='exercises.html'">
        <span class="icon"><i class="fa fa-hourglass-half"></i></span>
        <span class="label">Exercises</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='exams.html'">
        <span class="icon"><i class="fa fa-pen-nib"></i></span>
        <span class="label">Exams</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='messages.html'">
        <span class="icon"><i class="fa fa-comments"></i></span>
        <span class="label">Messages</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='results.html'">
        <span class="icon"><i class="fa fa-clipboard-list"></i></span>
        <span class="label">Results</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='subjects.html'">
        <span class="icon"><i class="fa fa-users"></i></span>
        <span class="label">Subjects</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='hostel.html'">
        <span class="icon"><i class="fa fa-school"></i></span>
        <span class="label">Hostel</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='transport.html'">
        <span class="icon"><i class="fa fa-bus"></i></span>
        <span class="label">Transport</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='admission-letter.html'">
        <span class="icon"><i class="fa fa-file-alt"></i></span>
        <span class="label">Admission Letter</span>
      </div>
      <div class="menu-card" tabindex="0" onclick="window.location.href='profile.html'">
        <span class="icon"><i class="fa fa-user"></i></span>
        <span class="label">My Profile</span>
      </div>
    </div>
    <!-- Section Card Example -->
    <div class="section-card">
      <div class="section-title">E-Class</div>
      <div class="section-content" id="eclassSummary">
        <div>My Classrooms</div>
        <div style="color: var(--text-muted); font-size: 0.97rem;">Unread messages</div>
      </div>
    </div>
    <!-- News & Updates -->
    <div class="news-card" id="newsCard">
      <div class="news-title">News &amp; Updates</div>
      <div class="news-empty" id="newsContent">No items found</div>
      <button class="news-btn" onclick="window.location.href='news.html'">News &amp; Events →</button>
    </div>
    <!-- Side Section for tablet/desktop (optional, could be for notifications, quick links etc) -->
    <div class="side-section" style="display:none;">
      <div class="section-title">Quick Updates</div>
      <div>Welcome back! Check your unread messages and new assignments.</div>
    </div>
  </div>
  <!-- BOTTOM NAV -->
  <div class="bottom-nav">
    <div class="nav-item active">
      <span class="icon"><i class="fa fa-home"></i></span>
      <span class="label">Home</span>
    </div>
    <div class="nav-item" onclick="window.location.href='fees.html'">
      <span class="icon"><i class="fa fa-wallet"></i></span>
      <span class="label">My Fees</span>
    </div>
    <div class="nav-item" onclick="window.location.href='results.html'">
      <span class="icon"><i class="fa fa-chart-bar"></i></span>
      <span class="label">My Results</span>
    </div>
    <div class="nav-item" onclick="window.location.href='e-class.html'">
      <span class="icon"><i class="fa fa-laptop"></i></span>
      <span class="label">E-class</span>
    </div>
    <div class="nav-item" onclick="window.location.href='menu.html'">
      <span class="icon"><i class="fa fa-ellipsis-h"></i></span>
      <span class="label">Menu</span>
    </div>
  </div>
  <script>
    // Responsive: tab navigation for menu cards
    document.querySelectorAll('.menu-card').forEach(card => {
      card.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          card.click();
        }
      });
    });
    // Show side section on desktop/tablet only
    function toggleSideSection() {
      const w = window.innerWidth;
      document.querySelector('.side-section').style.display = w >= 600 ? 'block' : 'none';
    }
    toggleSideSection();
    window.addEventListener('resize', toggleSideSection);

    // --- Dynamic Feature Fetch and Fill ---
    async function fetchStudentDashboard() {
      const token = localStorage.getItem('studentToken') || localStorage.getItem('token');
      if (!token) {
        document.getElementById('profileName').textContent = 'Please log in';
        document.getElementById('ttToday').textContent = 'Log in required';
        return;
      }
      try {
        const res = await fetch('/api/students/me', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!res.ok) throw new Error('Could not fetch student data');
        const data = await res.json();

        // Profile
        document.getElementById('profileName').textContent = (data.name || 'Student Name').toUpperCase();
        if (data.photo_url) {
          document.getElementById('profileAvatar').src = data.photo_url;
        } else if (data.name) {
          document.getElementById('profileAvatar').src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(data.name) + '&background=ff9900&color=fff';
        }

        // Timetable summary (today)
        if (data.timetable && Array.isArray(data.timetable)) {
          const weekday = new Date().toLocaleString('en-US', { weekday: 'long' }).toLowerCase();
          const todaySchedule = data.timetable.find(d => (d.day || '').toLowerCase() === weekday);
          if (todaySchedule && todaySchedule.subjects && todaySchedule.subjects.length > 0) {
            document.getElementById('ttToday').innerHTML = `<span style="color:var(--accent);font-weight:700">${weekday.toUpperCase()} (Today)</span><br>` +
              todaySchedule.subjects.map(sub =>
                `<div><strong>${sub.time || ''}</strong>: ${sub.name || sub.subject || ''}</div>`
              ).join('');
          } else {
            document.getElementById('ttToday').innerHTML = `<span style="color:var(--accent);font-weight:700">${weekday.toUpperCase()} (Today)</span><br>No classes today!`;
          }
        } else {
          document.getElementById('ttToday').textContent = 'No timetable data.';
        }

        // News & Updates
        if (data.news && data.news.length > 0) {
          document.getElementById('newsContent').innerHTML = data.news.map(news =>
            `<div class="news-item"><strong>${news.title}</strong><br><span style="color:#888;font-size:0.97em;">${news.date || ''}</span><br>${news.summary || ''}</div>`
          ).join('');
        } else {
          document.getElementById('newsContent').textContent = 'No items found';
        }

        // E-Class summary (section card)
        if (data.eclass_summary && Array.isArray(data.eclass_summary)) {
          document.getElementById('eclassSummary').innerHTML = data.eclass_summary.map(e =>
            `<div>${e}</div>`
          ).join('');
        }

      } catch (err) {
        document.getElementById('profileName').textContent = 'Unable to load student';
        document.getElementById('ttToday').textContent = 'Error loading data!';
        document.getElementById('newsContent').textContent = 'Could not fetch news';
      }
    }
    window.addEventListener('DOMContentLoaded', fetchStudentDashboard);

    // Bottom navigation active state (for demo)
    document.querySelectorAll('.bottom-nav .nav-item').forEach(item => {
      item.addEventListener('click', function () {
        document.querySelectorAll('.bottom-nav .nav-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
      });
    });
  </script>
</body>
</html>
